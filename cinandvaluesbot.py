import logging
import random
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import Application, CommandHandler, CallbackQueryHandler, ContextTypes, MessageHandler, filters

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)

BOT_TOKEN = "8156723328:AAF4NgfUZHUvfszZMZ28WBU_9pea1ZYRTz8"

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å–º–æ–≤
FILMS_DATABASE = {
    "–≤–µ—Å–Ω–∞ –Ω–∞ –∑–∞—Ä–µ—á–Ω–æ–π —É–ª–∏—Ü–µ": {
        "–≥–æ–¥": 1956,
        "—Ä–µ–∂–∏—Å—Å–µ—Ä": "–§–µ–ª–∏–∫—Å –ú–∏—Ä–æ–Ω–µ—Ä, –ú–∞—Ä–ª–µ–Ω –•—É—Ü–∏–µ–≤",
        "—Ü–µ–Ω–Ω–æ—Å—Ç–∏": ["–∫–æ–ª–ª–µ–∫—Ç–∏–≤–∏–∑–º", "—Ç—Ä—É–¥", "–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ", "—Ä–æ–º–∞–Ω—Ç–∏–∑–º"],
        "–∞–Ω–∞–ª–∏–∑": """üé¨ <b>–ê–Ω–∞–ª–∏–∑ "–í–µ—Å–Ω–∞ –Ω–∞ –ó–∞—Ä–µ—á–Ω–æ–π —É–ª–∏—Ü–µ"</b>

<b>–ö–ª—é—á–µ–≤—ã–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏:</b>
‚Ä¢ <b>–ö–æ–ª–ª–µ–∫—Ç–∏–≤–∏–∑–º</b> - –∂–∏–∑–Ω—å –≤ —Ä–∞–±–æ—á–µ–º –æ–±—â–µ–∂–∏—Ç–∏–∏, —Å–æ–≤–º–µ—Å—Ç–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º
‚Ä¢ <b>–¢—Ä—É–¥ –∫–∞–∫ —Å–∞–º–æ–≤—ã—Ä–∞–∂–µ–Ω–∏–µ</b> - —É—á–∏—Ç–µ–ª—å–Ω–∏—Ü–∞ –¢–∞—Ç—å—è–Ω–∞ –Ω–∞—Ö–æ–¥–∏—Ç —Å–º—ã—Å–ª –≤ —Ä–∞–±–æ—Ç–µ —Å —Ä–∞–±–æ—á–∏–º–∏
‚Ä¢ <b>–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</b> - –≤–µ—á–µ—Ä–Ω—è—è —à–∫–æ–ª–∞ –∫–∞–∫ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–π –ª–∏—Ñ—Ç
‚Ä¢ <b>–†–æ–º–∞–Ω—Ç–∏–∑–º</b> - —á–∏—Å—Ç–æ—Ç–∞ —á—É–≤—Å—Ç–≤, –ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö –±–∞—Ä—å–µ—Ä–æ–≤

<b>–ó–Ω–∞—á–∏–º—ã–µ —Å—Ü–µ–Ω—ã:</b>
1. –°—Ü–µ–Ω–∞ –≤ –æ–±—â–µ–∂–∏—Ç–∏–∏ - –∫–æ–ª–ª–µ–∫—Ç–∏–≤–Ω–æ–µ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ –∂–∏–∑–Ω–∏
2. –£—Ä–æ–∫ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã - —Å–ø–æ—Ä –æ –Ω–∞—Å—Ç–æ—è—â–µ–º —Å—á–∞—Å—Ç—å–µ
3. –§–∏–Ω–∞–ª –Ω–∞ —Å—Ç—Ä–æ–π–∫–µ - –º–µ—Ç–∞—Ñ–æ—Ä–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∂–∏–∑–Ω–∏

<b>–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç:</b> –§–∏–ª—å–º —Å–Ω—è—Ç –≤ –ø–µ—Ä–∏–æ–¥ "–æ—Ç—Ç–µ–ø–µ–ª–∏", –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–º—è–≥—á–µ–Ω–∏–µ –∏–¥–µ–æ–ª–æ–≥–∏–∏.""",
        "—Ü–∏—Ç–∞—Ç—ã": [
            "¬´–°—á–∞—Å—Ç—å–µ ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ —Ç–µ–±—è –ø–æ–Ω–∏–º–∞—é—Ç¬ª",
            "¬´–ú—ã –Ω–µ –∏—â–µ–º –ª–µ–≥–∫–∏—Ö –ø—É—Ç–µ–π!¬ª"
        ]
    },
    "–¥–æ–∂–∏–≤–µ–º –¥–æ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞": {
        "–≥–æ–¥": 1968,
        "—Ä–µ–∂–∏—Å—Å–µ—Ä": "–°—Ç–∞–Ω–∏—Å–ª–∞–≤ –†–æ—Å—Ç–æ—Ü–∫–∏–π",
        "—Ü–µ–Ω–Ω–æ—Å—Ç–∏": ["–Ω—Ä–∞–≤—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å", "–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ", "–∏—Å–∫—Ä–µ–Ω–Ω–æ—Å—Ç—å", "–º–æ—Ä–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä"],
        "–∞–Ω–∞–ª–∏–∑": """üé¨ <b>–ê–Ω–∞–ª–∏–∑ "–î–æ–∂–∏–≤–µ–º –¥–æ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞"</b>

<b>–ö–ª—é—á–µ–≤—ã–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏:</b>
‚Ä¢ <b>–ù—Ä–∞–≤—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä</b> - —É—á–∏—Ç–µ–ª—å –ú–µ–ª—å–Ω–∏–∫–æ–≤ –ø—Ä–æ—Ç–∏–≤ —Ü–∏–Ω–∏–∑–º–∞ –∫–æ–ª–ª–µ–≥–∏
‚Ä¢ <b>–ò—Å–∫—Ä–µ–Ω–Ω–æ—Å—Ç—å</b> - –∏—Å—Ç–æ—Ä–∏—è —Å –ø–æ–¥–¥–µ–ª—å–Ω—ã–º–∏ –ø–∏—Å—å–º–∞–º–∏
‚Ä¢ <b>–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –¥–æ–ª–≥</b> - –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—é
‚Ä¢ <b>–ß–µ—Å—Ç–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–¥ —Å–æ–±–æ–π</b> - –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≥–µ—Ä–æ–µ–≤

<b>–ü–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–µ –∞—Å–ø–µ–∫—Ç—ã:</b>
‚Ä¢ –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã—Ö –∏ –Ω–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –æ–±—É—á–µ–Ω–∏—è
‚Ä¢ –ü—Ä–æ–±–ª–µ–º–∞ –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–∞ —É—á–∏—Ç–µ–ª—è
‚Ä¢ –í–æ—Å–ø–∏—Ç–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—É –∏ –∏—Å—Ç–æ—Ä–∏—é""",
        "—Ü–∏—Ç–∞—Ç—ã": [
            "¬´–°—á–∞—Å—Ç—å–µ ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ —Ç–µ–±—è –ø–æ–Ω–∏–º–∞—é—Ç¬ª",
            "¬´–ò—Å—Ç–æ—Ä–∏—è ‚Äî —ç—Ç–æ –Ω–∞—É–∫–∞ –æ —á–µ–ª–æ–≤–µ–∫–µ –≤–æ –≤—Ä–µ–º–µ–Ω–∏¬ª"
        ]
    },
    "–º–æ—Å–∫–≤–∞ —Å–ª–µ–∑–∞–º –Ω–µ –≤–µ—Ä–∏—Ç": {
        "–≥–æ–¥": 1979,
        "—Ä–µ–∂–∏—Å—Å–µ—Ä": "–í–ª–∞–¥–∏–º–∏—Ä –ú–µ–Ω—å—à–æ–≤",
        "—Ü–µ–Ω–Ω–æ—Å—Ç–∏": ["–∂–µ–Ω—Å–∫–∞—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å", "—Ç—Ä—É–¥", "—Å–µ–º—å—è", "—Å–æ—Ü–∏–∞–ª—å–Ω–∞—è –º–æ–±–∏–ª—å–Ω–æ—Å—Ç—å"],
        "–∞–Ω–∞–ª–∏–∑": """üé¨ <b>–ê–Ω–∞–ª–∏–∑ "–ú–æ—Å–∫–≤–∞ —Å–ª–µ–∑–∞–º –Ω–µ –≤–µ—Ä–∏—Ç"</b>

<b>–ö–ª—é—á–µ–≤—ã–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏:</b>
‚Ä¢ <b>–ñ–µ–Ω—Å–∫–∞—è —ç–º–∞–Ω—Å–∏–ø–∞—Ü–∏—è</b> - –∫–∞—Ä—å–µ—Ä–Ω—ã–π —Ä–æ—Å—Ç –ö–∞—Ç–µ—Ä–∏–Ω—ã
‚Ä¢ <b>–¢—Ä—É–¥–æ–ª—é–±–∏–µ</b> - –ø—É—Ç—å –æ—Ç —Ä–∞–±–æ—á–µ–π –¥–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞
‚Ä¢ <b>–°–µ–º–µ–π–Ω—ã–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏</b> - –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ñ–µ–º–∏–Ω–∏—Å—Ç—Å–∫–∏–µ –º–æ—Ç–∏–≤—ã
‚Ä¢ <b>–°–æ—Ü–∏–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å</b> - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∂–µ–Ω—â–∏–Ω—ã –≤ –æ–±—â–µ—Å—Ç–≤–µ

<b>–°–æ—Ü–∏–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç:</b>
‚Ä¢ –ü–æ–∫–∞–∑–∞–Ω –ø–µ—Ä–µ—Ö–æ–¥ –æ—Ç –∫–æ–ª–ª–µ–∫—Ç–∏–≤–Ω—ã—Ö –∫ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–º —Ü–µ–Ω–Ω–æ—Å—Ç—è–º
‚Ä¢ –ö–æ–Ω—Ñ–ª–∏–∫—Ç "—Å—Ç–∞—Ä–æ–≥–æ" –∏ "–Ω–æ–≤–æ–≥–æ" –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö
‚Ä¢ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≥–µ–Ω–¥–µ—Ä–Ω—ã—Ö —Ä–æ–ª–µ–π –≤ –ø–æ–∑–¥–Ω–µ–º –°–°–°–†""",
        "—Ü–∏—Ç–∞—Ç—ã": [
            "¬´–í —Å–æ—Ä–æ–∫ –ª–µ—Ç –∂–∏–∑–Ω—å —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è¬ª",
            "¬´–í–∞–º –Ω—É–∂–Ω–∞ –Ω–µ –∂–µ–Ω–∞, –∞ –ø—Ä–∏—Å–ª—É–≥–∞¬ª"
        ]
    },
    "–æ—Ñ–∏—Ü–µ—Ä—ã": {
        "–≥–æ–¥": 1971,
        "—Ä–µ–∂–∏—Å—Å–µ—Ä": "–í–ª–∞–¥–∏–º–∏—Ä –†–æ–≥–æ–≤–æ–π",
        "—Ü–µ–Ω–Ω–æ—Å—Ç–∏": ["–ø–∞—Ç—Ä–∏–æ—Ç–∏–∑–º", "–≤–µ—Ä–Ω–æ—Å—Ç—å –¥–æ–ª–≥—É", "–¥—Ä—É–∂–±–∞", "–ø—Ä–µ–µ–º—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –ø–æ–∫–æ–ª–µ–Ω–∏–π"],
        "–∞–Ω–∞–ª–∏–∑": """üé¨ <b>–ê–Ω–∞–ª–∏–∑ "–û—Ñ–∏—Ü–µ—Ä—ã"</b>

<b>–ö–ª—é—á–µ–≤—ã–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏:</b>
‚Ä¢ <b>–ü–∞—Ç—Ä–∏–æ—Ç–∏–∑–º</b> - —Å–ª—É–∂–µ–Ω–∏–µ –†–æ–¥–∏–Ω–µ –∫–∞–∫ –≤—ã—Å—à–∞—è —Ü–µ–ª—å
‚Ä¢ <b>–í–æ–∏–Ω—Å–∫–æ–µ –±—Ä–∞—Ç—Å—Ç–≤–æ</b> - –¥—Ä—É–∂–±–∞ –ê–ª–µ–∫—Å–µ—è –∏ –ò–≤–∞–Ω–∞
‚Ä¢ <b>–ü—Ä–µ–µ–º—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å</b> - —Å—ã–Ω –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –¥–µ–ª–æ –æ—Ç—Ü–∞
‚Ä¢ <b>–ñ–µ—Ä—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å</b> - –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –æ—Ç–¥–∞—Ç—å –∂–∏–∑–Ω—å –∑–∞ —Å—Ç—Ä–∞–Ω—É

<b>–ò–¥–µ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞—Å–ø–µ–∫—Ç:</b>
‚Ä¢ –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ –æ—Ñ–∏—Ü–µ—Ä–∞-–≥–µ—Ä–æ—è
‚Ä¢ –û–ø—Ä–∞–≤–¥–∞–Ω–∏–µ –≤–æ–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –°–°–°–†
‚Ä¢ –í–æ—Å–ø–∏—Ç–∞–Ω–∏–µ –º–æ–ª–æ–¥–µ–∂–∏ –≤ –¥—É—Ö–µ –ø—Ä–µ–¥–∞–Ω–Ω–æ—Å—Ç–∏ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤—É""",
        "—Ü–∏—Ç–∞—Ç—ã": [
            "¬´–ï—Å—Ç—å —Ç–∞–∫–∞—è –ø—Ä–æ—Ñ–µ—Å—Å–∏—è ‚Äî –†–æ–¥–∏–Ω—É –∑–∞—â–∏—â–∞—Ç—å¬ª",
            "¬´–ú—ã –≤ –æ—Ç–≤–µ—Ç–µ –∑–∞ —Ç–µ—Ö, –∫–æ–≥–æ –ø—Ä–∏—Ä—É—á–∏–ª–∏¬ª"
        ]
    },
    "–∏—Ä–æ–Ω–∏—è —Å—É–¥—å–±—ã": {
        "–≥–æ–¥": 1975,
        "—Ä–µ–∂–∏—Å—Å–µ—Ä": "–≠–ª—å–¥–∞—Ä –†—è–∑–∞–Ω–æ–≤",
        "—Ü–µ–Ω–Ω–æ—Å—Ç–∏": ["—Ä–æ–º–∞–Ω—Ç–∏–∫–∞", "–∏–Ω—Ç–µ–ª–ª–∏–≥–µ–Ω—Ç–Ω–æ—Å—Ç—å", "–¥—Ä—É–∂–±–∞", "—Å–ª—É—á–∞–π –∏ —Å—É–¥—å–±–∞"],
        "–∞–Ω–∞–ª–∏–∑": """üé¨ <b>–ê–Ω–∞–ª–∏–∑ "–ò—Ä–æ–Ω–∏—è —Å—É–¥—å–±—ã, –∏–ª–∏ –° –ª–µ–≥–∫–∏–º –ø–∞—Ä–æ–º!"</b>

<b>–ö–ª—é—á–µ–≤—ã–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏:</b>
‚Ä¢ <b>–†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –ª—é–±–æ–≤—å</b> - —Å–ª—É—á–∞–π–Ω–∞—è –≤—Å—Ç—Ä–µ—á–∞ –∫–∞–∫ —Å—É–¥—å–±–∞
‚Ä¢ <b>–ò–Ω—Ç–µ–ª–ª–∏–≥–µ–Ω—Ç–Ω–æ—Å—Ç—å</b> - –æ–±—Ä–∞–∑ –≥–ª–∞–≤–Ω–æ–≥–æ –≥–µ—Ä–æ—è-—Ñ–∏–ª–æ–ª–æ–≥–∞
‚Ä¢ <b>–î—Ä—É–∂–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞</b> - –ø–æ–º–æ—â—å –¥—Ä—É–∑–µ–π –≤ —Å–ª–æ–∂–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏
‚Ä¢ <b>–ü–æ–∏—Å–∫ –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ —á—É–≤—Å—Ç–≤–∞</b> - –ø—Ä–æ—Ç–∏–≤ —Ñ–æ—Ä–º–∞–ª–∏–∑–º–∞ –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö

<b>–°–æ—Ü–∏–∞–ª—å–Ω—ã–π –ø–æ–¥—Ç–µ–∫—Å—Ç:</b>
‚Ä¢ –ö—Ä–∏—Ç–∏–∫–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏–∏ –∂–∏–∑–Ω–∏ –≤ –°–°–°–†
‚Ä¢ –¢–∏–ø–æ–≤—ã–µ –¥–æ–º–∞ –∫–∞–∫ –º–µ—Ç–∞—Ñ–æ—Ä–∞ –æ–¥–∏–Ω–∞–∫–æ–≤–æ—Å—Ç–∏
‚Ä¢ –ü–æ–∏—Å–∫ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ—Å—Ç–∏ –≤ –º–∞—Å—Å–æ–≤–æ–º –æ–±—â–µ—Å—Ç–≤–µ""",
        "—Ü–∏—Ç–∞—Ç—ã": [
            "¬´–ö–∞–∫–æ–µ –ø—Ä–æ—Å—Ç–æ–µ –∏ –Ω—É–∂–Ω–æ–µ —Å–ª–æ–≤–æ ‚Äî —É—Ö–æ–¥–∏!¬ª",
            "¬´–Ø —É–µ–∑–∂–∞—é –≤ –õ–µ–Ω–∏–Ω–≥—Ä–∞–¥ –∏, –Ω–∞–≤–µ—Ä–Ω–æ–µ, –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤–µ—Ä–Ω—É—Å—å¬ª"
        ]
    }
}

# –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –ø–æ —Ü–µ–Ω–Ω–æ—Å—Ç—è–º
VALUES_DATABASE = {
    "–∫–æ–ª–ª–µ–∫—Ç–∏–≤–∏–∑–º": {
        "–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ": "–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∫–æ–ª–ª–µ–∫—Ç–∏–≤–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –Ω–∞–¥ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–º–∏, –∏–¥–µ—è –æ–±—â–µ–≥–æ –±–ª–∞–≥–∞",
        "–ø—Ä–æ—è–≤–ª–µ–Ω–∏—è": [
            "–°–æ–≤–º–µ—Å—Ç–Ω—ã–π —Ç—Ä—É–¥ –∏ –æ—Ç–¥—ã—Ö",
            "–ö–æ–ª–ª–µ–∫—Ç–∏–≤–Ω–æ–µ –ø—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏–π", 
            "–í–∑–∞–∏–º–æ–ø–æ–º–æ—â—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞",
            "–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å"
        ],
        "—Ñ–∏–ª—å–º—ã": ["–í–µ—Å–Ω–∞ –Ω–∞ –ó–∞—Ä–µ—á–Ω–æ–π —É–ª–∏—Ü–µ", "–î–æ–±—Ä–æ–≤–æ–ª—å—Ü—ã", "–í—ã—Å–æ—Ç–∞", "–ö–æ–º–º—É–Ω–∏—Å—Ç"],
        "–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π_–∫–æ–Ω—Ç–µ–∫—Å—Ç": "–í–æ—Å–ø–∏—Ç—ã–≤–∞–ª—Å—è —á–µ—Ä–µ–∑ –ø–∏–æ–Ω–µ—Ä–∏—é, –∫–æ–º—Å–æ–º–æ–ª, –∫–æ–ª–ª–µ–∫—Ç–∏–≤—ã –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ"
    },
    "—Ç—Ä—É–¥": {
        "–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ": "–¢—Ä—É–¥ –∫–∞–∫ –≤—ã—Å—à–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å –∏ —Å–º—ã—Å–ª –∂–∏–∑–Ω–∏, –≥–µ—Ä–æ–∏–∑–º —Ç—Ä—É–¥–æ–≤—ã—Ö –±—É–¥–Ω–µ–π",
        "–ø—Ä–æ—è–≤–ª–µ–Ω–∏—è": [
            "–í–æ—Å–ø–µ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—á–∏—Ö –ø—Ä–æ—Ñ–µ—Å—Å–∏–π",
            "–¢—Ä—É–¥ –∫–∞–∫ —Å–∞–º–æ–≤—ã—Ä–∞–∂–µ–Ω–∏–µ",
            "–°–æ—Ü–∏–∞–ª–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ",
            "–£–¥–∞—Ä–Ω–∏—á–µ—Å—Ç–≤–æ –∏ —Å—Ç–∞—Ö–∞–Ω–æ–≤—Å–∫–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ"
        ],
        "—Ñ–∏–ª—å–º—ã": ["–í—ã—Å–æ—Ç–∞", "–ö–æ–º–º—É–Ω–∏—Å—Ç", "–í–µ—Å–Ω–∞ –Ω–∞ –ó–∞—Ä–µ—á–Ω–æ–π —É–ª–∏—Ü–µ", "–ë–æ–ª—å—à–∞—è –∂–∏–∑–Ω—å"],
        "–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π_–∫–æ–Ω—Ç–µ–∫—Å—Ç": "–ò–Ω–¥—É—Å—Ç—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–ª–∞ –≤–æ—Å–ø–∏—Ç–∞–Ω–∏—è —É–≤–∞–∂–µ–Ω–∏—è –∫ —Ç—Ä—É–¥—É"
    },
    "–ø–∞—Ç—Ä–∏–æ—Ç–∏–∑–º": {
        "–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ": "–õ—é–±–æ–≤—å –∫ –†–æ–¥–∏–Ω–µ, –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å —Å–ª—É–∂–∏—Ç—å –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤—É –∏ –∑–∞—â–∏—â–∞—Ç—å –µ–≥–æ",
        "–ø—Ä–æ—è–≤–ª–µ–Ω–∏—è": [
            "–í–æ–∏–Ω—Å–∫–∏–π –¥–æ–ª–≥",
            "–°–ª—É–∂–±–∞ –û—Ç–µ—á–µ—Å—Ç–≤—É",
            "–ò–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –¥–æ–ª–≥",
            "–ì–æ—Ä–¥–æ—Å—Ç—å –∑–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω—ã"
        ],
        "—Ñ–∏–ª—å–º—ã": ["–û—Ñ–∏—Ü–µ—Ä—ã", "–©–∏—Ç –∏ –º–µ—á", "–ê –∑–æ—Ä–∏ –∑–¥–µ—Å—å —Ç–∏—Ö–∏–µ", "–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ"],
        "–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π_–∫–æ–Ω—Ç–µ–∫—Å—Ç": "–í–æ—Å–ø–∏—Ç–∞–Ω–∏–µ –≤ —É—Å–ª–æ–≤–∏—è—Ö —Ö–æ–ª–æ–¥–Ω–æ–π –≤–æ–π–Ω—ã –∏ –ø–∞–º—è—Ç–∏ –æ –í–û–í"
    }
}

# –í–∏–∫—Ç–æ—Ä–∏–Ω–∞
QUIZ_QUESTIONS = [
    {
        "question": "–ö–∞–∫–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å –±—ã–ª–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π –≤ —Ñ–∏–ª—å–º–µ '–û—Ñ–∏—Ü–µ—Ä—ã'?",
        "options": ["–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª–∏–∑–º", "–ö–∞—Ä—å–µ—Ä–Ω—ã–π —Ä–æ—Å—Ç", "–°–ª—É–∂–µ–Ω–∏–µ –†–æ–¥–∏–Ω–µ", "–ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–µ –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏–µ"],
        "correct": 2,
        "explanation": "–§–∏–ª—å–º –≤–æ—Å–ø–µ–≤–∞–µ—Ç –ø–∞—Ç—Ä–∏–æ—Ç–∏–∑–º –∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å —Å–ª—É–∂–∏—Ç—å –û—Ç–µ—á–µ—Å—Ç–≤—É."
    },
    {
        "question": "–ß—Ç–æ —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä—É—é—Ç —Ç–∏–ø–æ–≤—ã–µ –¥–æ–º–∞ –≤ '–ò—Ä–æ–Ω–∏–∏ —Å—É–¥—å–±—ã'?",
        "options": ["–ü—Ä–æ–≥—Ä–µ—Å—Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã", "–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—é –∂–∏–∑–Ω–∏", "–†–æ—Å–∫–æ—à—å –∂–∏–ª—å—è", "–≠–∫–æ–ª–æ–≥–∏—á–Ω–æ—Å—Ç—å"],
        "correct": 1,
        "explanation": "–¢–∏–ø–æ–≤—ã–µ –¥–æ–º–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ—Å—Ç—å –∏ –æ–±–µ–∑–ª–∏—á–µ–Ω–Ω–æ—Å—Ç—å —Å–æ–≤–µ—Ç—Å–∫–æ–≥–æ –±—ã—Ç–∞."
    },
    {
        "question": "–ö–∞–∫–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å –ù–ï —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω–∞ –¥–ª—è —Ñ–∏–ª—å–º–∞ '–í–µ—Å–Ω–∞ –Ω–∞ –ó–∞—Ä–µ—á–Ω–æ–π —É–ª–∏—Ü–µ'?",
        "options": ["–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª–∏–∑–º", "–ö–æ–ª–ª–µ–∫—Ç–∏–≤–∏–∑–º", "–¢—Ä—É–¥", "–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ"],
        "correct": 0,
        "explanation": "–§–∏–ª—å–º –ø—Ä–æ–ø–∞–≥–∞–Ω–¥–∏—Ä—É–µ—Ç –∫–æ–ª–ª–µ–∫—Ç–∏–≤–∏–∑–º, –∞ –Ω–µ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª–∏–∑–º."
    },
    {
        "question": "–ö–∞–∫–æ–π –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–∏–æ–¥ –æ—Ç—Ä–∞–∂–∞–µ—Ç —Ñ–∏–ª—å–º '–í–µ—Å–Ω–∞ –Ω–∞ –ó–∞—Ä–µ—á–Ω–æ–π —É–ª–∏—Ü–µ'?",
        "options": ["–ì—Ä–∞–∂–¥–∞–Ω—Å–∫–∞—è –≤–æ–π–Ω–∞", "–ò–Ω–¥—É—Å—Ç—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è", "–û—Ç—Ç–µ–ø–µ–ª—å", "–ü–µ—Ä–µ—Å—Ç—Ä–æ–π–∫–∞"],
        "correct": 2,
        "explanation": "–§–∏–ª—å–º —Å–Ω—è—Ç –≤ 1956 –≥–æ–¥—É –∏ –æ—Ç—Ä–∞–∂–∞–µ—Ç –ø–µ—Ä–∏–æ–¥ '–æ—Ç—Ç–µ–ø–µ–ª–∏'."
    },
    {
        "question": "–ß—Ç–æ —Å—Ç–∞–ª–æ —Å–∏–º–≤–æ–ª–æ–º –∂–µ–Ω—Å–∫–æ–π —ç–º–∞–Ω—Å–∏–ø–∞—Ü–∏–∏ –≤ '–ú–æ—Å–∫–≤–∞ —Å–ª–µ–∑–∞–º –Ω–µ –≤–µ—Ä–∏—Ç'?",
        "options": ["–ö–∞—Ä—å–µ—Ä–∞ –ö–∞—Ç–µ—Ä–∏–Ω—ã", "–û–±—â–µ–∂–∏—Ç–∏–µ", "–í–µ—á–µ—Ä–Ω—è—è —à–∫–æ–ª–∞", "–î—Ä—É–∂–±–∞ —Å –ø–æ–¥—Ä—É–≥–∞–º–∏"],
        "correct": 0,
        "explanation": "–ü—É—Ç—å –ö–∞—Ç–µ—Ä–∏–Ω—ã –æ—Ç —Ä–∞–±–æ—á–µ–π –¥–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞ –∑–∞–≤–æ–¥–∞ - —Å–∏–º–≤–æ–ª –∂–µ–Ω—Å–∫–æ–π —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏."
    },
    {
        "question": "–ö–∞–∫–∞—è —Ü–∏—Ç–∞—Ç–∞ —Å—Ç–∞–ª–∞ –∑–Ω–∞–º–µ–Ω–∏—Ç–æ–π –∏–∑ —Ñ–∏–ª—å–º–∞ '–î–æ–∂–∏–≤–µ–º –¥–æ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞'?",
        "options": [
            "¬´–°—á–∞—Å—Ç—å–µ ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ —Ç–µ–±—è –ø–æ–Ω–∏–º–∞—é—Ç¬ª",
            "¬´–õ—é–±–≤–∏ –≤—Å–µ –≤–æ–∑—Ä–∞—Å—Ç—ã –ø–æ–∫–æ—Ä–Ω—ã¬ª", 
            "¬´–í —Å–æ—Ä–æ–∫ –ª–µ—Ç –∂–∏–∑–Ω—å —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è¬ª",
            "¬´–ï—Å—Ç—å —Ç–∞–∫–∞—è –ø—Ä–æ—Ñ–µ—Å—Å–∏—è ‚Äî –†–æ–¥–∏–Ω—É –∑–∞—â–∏—â–∞—Ç—å¬ª"
        ],
        "correct": 0,
        "explanation": "–ò–º–µ–Ω–Ω–æ —Ñ—Ä–∞–∑–∞ ¬´–°—á–∞—Å—Ç—å–µ ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ —Ç–µ–±—è –ø–æ–Ω–∏–º–∞—é—Ç¬ª —Å—Ç–∞–ª–∞ –∫—É–ª—å—Ç–æ–≤–æ–π."
    },
    {
        "question": "–ö–∞–∫–æ–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ–∫–∞–∑–∞–Ω –≤ '–î–æ–∂–∏–≤–µ–º –¥–æ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞'?",
        "options": [
            "–ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ–∫–æ–ª–µ–Ω–∏–π",
            "–ë–æ—Ä—å–±–∞ –∑–∞ –≤–ª–∞—Å—Ç—å –≤ —à–∫–æ–ª–µ", 
            "–°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã—Ö –∏ –Ω–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –æ–±—É—á–µ–Ω–∏—è",
            "–õ—é–±–æ–≤–Ω—ã–π —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫"
        ],
        "correct": 2,
        "explanation": "–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç - –º–µ–∂–¥—É —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–º–∏ –∏ –Ω–æ–≤—ã–º–∏ –ø–æ–¥—Ö–æ–¥–∞–º–∏ –∫ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—é."
    },
    {
        "question": "–ß—Ç–æ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –≥–µ—Ä–æ–µ–≤ —Ñ–∏–ª—å–º–∞ '–û—Ñ–∏—Ü–µ—Ä—ã' –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ –≤—Å–µ–π –∂–∏–∑–Ω–∏?",
        "options": [
            "–õ—é–±–æ–≤—å –∫ –æ–¥–Ω–æ–π –∂–µ–Ω—â–∏–Ω–µ",
            "–°–ª—É–∂–±–∞ –≤ –æ–¥–Ω–æ–º –ø–æ–ª–∫—É", 
            "–î—Ä—É–∂–±–∞ –∏ –≤–µ—Ä–Ω–æ—Å—Ç—å –≤–æ–∏–Ω—Å–∫–æ–º—É –¥–æ–ª–≥—É",
            "–û–±—â–µ–µ –¥–µ–ª–æ –Ω–∞ –≥—Ä–∞–∂–¥–∞–Ω–∫–µ"
        ],
        "correct": 2,
        "explanation": "–î—Ä—É–∂–±–∞ –∏ –ø—Ä–µ–¥–∞–Ω–Ω–æ—Å—Ç—å –≤–æ–∏–Ω—Å–∫–æ–º—É –¥–æ–ª–≥—É –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –≤—Å—é –∂–∏–∑–Ω—å –≥–µ—Ä–æ–µ–≤."
    },
    {
        "question": "–ö–∞–∫–æ–π —Å–æ—Ü–∏–∞–ª—å–Ω—ã–π –ª–∏—Ñ—Ç –ø–æ–∫–∞–∑–∞–Ω –≤ '–í–µ—Å–Ω–∞ –Ω–∞ –ó–∞—Ä–µ—á–Ω–æ–π —É–ª–∏—Ü–µ'?",
        "options": [
            "–ü–∞—Ä—Ç–∏–π–Ω–∞—è –∫–∞—Ä—å–µ—Ä–∞",
            "–í–µ—á–µ—Ä–Ω—è—è —à–∫–æ–ª–∞ –¥–ª—è —Ä–∞–±–æ—á–∏—Ö", 
            "–ü–µ—Ä–µ–µ–∑–¥ –≤ —Å—Ç–æ–ª–∏—Ü—É",
            "–ë—Ä–∞–∫ —Å –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª–µ–º –≤—ã—Å—à–µ–≥–æ –∫–ª–∞—Å—Å–∞"
        ],
        "correct": 1,
        "explanation": "–í–µ—á–µ—Ä–Ω—è—è —à–∫–æ–ª–∞ –¥–∞–≤–∞–ª–∞ —Ä–∞–±–æ—á–∏–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–∏—Ç—å –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—å—Å—è."
    },
    {
        "question": "–ß—Ç–æ –∫—Ä–∏—Ç–∏–∫—É–µ—Ç '–ò—Ä–æ–Ω–∏—è —Å—É–¥—å–±—ã' –≤ —Å–æ–≤–µ—Ç—Å–∫–æ–º –æ–±—â–µ—Å—Ç–≤–µ?",
        "options": [
            "–í–æ–µ–Ω–Ω—É—é –ø–æ–ª–∏—Ç–∏–∫—É",
            "–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—é –∏ –æ–±–µ–∑–ª–∏—á–µ–Ω–Ω–æ—Å—Ç—å", 
            "–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è",
            "–ù–∏–∑–∫–∏–µ –∑–∞—Ä–ø–ª–∞—Ç—ã"
        ],
        "correct": 1,
        "explanation": "–§–∏–ª—å–º –º—è–≥–∫–æ –∫—Ä–∏—Ç–∏–∫—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—é –∂–∏–∑–Ω–∏ —á–µ—Ä–µ–∑ –æ–±—Ä–∞–∑ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –¥–æ–º–æ–≤."
    }
]

# –ö–æ–º–∞–Ω–¥–∞ /start
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    try:
        user_name = update.message.from_user.first_name
        
        welcome_text = f"""
üé¨ –ü—Ä–∏–≤–µ—Ç, {user_name}! 
–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –±–æ—Ç ¬´–¶–µ–Ω–Ω–æ—Å—Ç–∏ –≤ —Å–æ–≤–µ—Ç—Å–∫–æ–º –∫–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ–µ¬ª!

–ó–¥–µ—Å—å —Ç—ã —Å–º–æ–∂–µ—à—å:
‚Ä¢ –ò–∑—É—á–∏—Ç—å –∫–ª—é—á–µ–≤—ã–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –ø—Ä–∏–∑–º—É –∫–∏–Ω–æ
‚Ä¢ –ü–æ–ª—É—á–∏—Ç—å –ø–æ–¥–±–æ—Ä–∫–∏ —Ñ–∏–ª—å–º–æ–≤ –ø–æ —Ç–µ–º–∞–º
‚Ä¢ –ù–∞–π—Ç–∏ –º–∞—Ç–µ—Ä–∏–∞–ª –¥–ª—è —É—á–µ–±–Ω—ã—Ö —Ä–∞–±–æ—Ç
‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–Ω–∞–Ω–∏—è –≤ –≤–∏–∫—Ç–æ—Ä–∏–Ω–µ
‚Ä¢ –ü–æ–ª—É—á–∏—Ç—å –∞–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ñ–∏–ª—å–º–æ–≤

–í—ã–±–µ—Ä–∏ —Ä–∞–∑–¥–µ–ª –Ω–∏–∂–µ üëá
"""
        
        keyboard = [
            [InlineKeyboardButton("üìö –û—Å–Ω–æ–≤–Ω—ã–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏", callback_data="values")],
            [InlineKeyboardButton("üé≠ –§–∏–ª—å–º—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º", callback_data="categories")],
            [InlineKeyboardButton("üîç –ê–Ω–∞–ª–∏–∑ —Ñ–∏–ª—å–º–∞", callback_data="film_analysis")],
            [InlineKeyboardButton("üìñ –≠–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—è —Ü–µ–Ω–Ω–æ—Å—Ç–µ–π", callback_data="encyclopedia")],
            [InlineKeyboardButton("‚ùì –í–∏–∫—Ç–æ—Ä–∏–Ω–∞", callback_data="quiz_start")],
            [InlineKeyboardButton("üí° –î–ª—è —É—á–µ–±—ã", callback_data="study")],
            [InlineKeyboardButton("üéØ –°–ª—É—á–∞–π–Ω—ã–π —Ñ–∏–ª—å–º", callback_data="random_film")]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)
        
        await update.message.reply_text(welcome_text, reply_markup=reply_markup)
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –≤ –∫–æ–º–∞–Ω–¥–µ start: {e}")
        await update.message.reply_text("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.")

# –û—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–æ–∫
async def button_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    try:
        query = update.callback_query
        await query.answer()
        
        data = query.data
        
        if data == "values":
            await show_values(query)
        elif data == "categories":
            await show_categories(query)
        elif data == "film_analysis":
            await show_film_analysis_menu(query)
        elif data == "encyclopedia":
            await show_encyclopedia_menu(query)
        elif data.startswith("value_"):
            await show_value_detail(query, data)
        elif data.startswith("film_"):
            await show_film_detail(query, data)
        elif data == "random_film":
            await show_random_film(query)
        elif data == "quiz_start":
            await start_quiz(query, context)
        elif data.startswith("quiz_"):
            await handle_quiz_answer(query, context, data)
        elif data == "study":
            await show_study_materials(query)
        else:
            await show_main_menu(query)
            
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ –∫–Ω–æ–ø–æ–∫: {e}")
        await query.edit_message_text("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /start –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞.")

async def show_values(query):
    text = """
üèõÔ∏è <b>–ö–ª—é—á–µ–≤—ã–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –≤ —Å–æ–≤–µ—Ç—Å–∫–æ–º –∫–∏–Ω–æ:</b>

1. <b>–ö–æ–ª–ª–µ–∫—Ç–∏–≤–∏–∑–º</b> - "–û–¥–∏–Ω –∑–∞ –≤—Å–µ—Ö –∏ –≤—Å–µ –∑–∞ –æ–¥–Ω–æ–≥–æ"
   ‚Ä¢ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ–±—â–µ–≥–æ –Ω–∞–¥ –ª–∏—á–Ω—ã–º
   ‚Ä¢ –í–∑–∞–∏–º–æ–ø–æ–º–æ—â—å –∏ —Ç–æ–≤–∞—Ä–∏—â–µ—Å—Ç–≤–æ

2. <b>–¢—Ä—É–¥ –∫–∞–∫ –¥–æ–±–ª–µ—Å—Ç—å</b>
   ‚Ä¢ –ì–µ—Ä–æ–∏–∑–º —Ç—Ä—É–¥–æ–≤—ã—Ö –±—É–¥–Ω–µ–π
   ‚Ä¢ –£–≤–∞–∂–µ–Ω–∏–µ –∫ —Ä–∞–±–æ—á–µ–º—É —á–µ–ª–æ–≤–µ–∫—É

3. <b>–ü–∞—Ç—Ä–∏–æ—Ç–∏–∑–º –∏ –∏–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–º</b>
   ‚Ä¢ –õ—é–±–æ–≤—å –∫ –†–æ–¥–∏–Ω–µ –±–µ–∑ –Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–º–∞
   ‚Ä¢ –î—Ä—É–∂–±–∞ –Ω–∞—Ä–æ–¥–æ–≤

4. <b>–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å –∏ –ø—Ä–∞–≤–¥–∞</b>
   ‚Ä¢ –ë–æ—Ä—å–±–∞ –∑–∞ –ø—Ä–∞–≤–¥—É –ø—Ä–æ—Ç–∏–≤ –Ω–µ—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç–∏
   ‚Ä¢ –ù—Ä–∞–≤—Å—Ç–≤–µ–Ω–Ω–∞—è —á–∏—Å—Ç–æ—Ç–∞ –≥–µ—Ä–æ–µ–≤

5. <b>–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—É–∫–∞</b>
   ‚Ä¢ –ö—É–ª—å—Ç –∑–Ω–∞–Ω–∏–π –∏ –ø—Ä–æ—Å–≤–µ—â–µ–Ω–∏—è
   ‚Ä¢ –£—á–µ–Ω—ã–π –∫–∞–∫ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π –≥–µ—Ä–æ–π

6. <b>–†–æ–º–∞–Ω—Ç–∏–∫–∞ –∏ –ª—é–±–æ–≤—å</b>
   ‚Ä¢ –ß–∏—Å—Ç–æ—Ç–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏–π
   ‚Ä¢ –õ—é–±–æ–≤—å –∫–∞–∫ –¥—É—Ö–æ–≤–Ω–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å
"""
    keyboard = [
        [InlineKeyboardButton("üé≠ –ü—Ä–∏–º–µ—Ä—ã —Ñ–∏–ª—å–º–æ–≤", callback_data="categories")],
        [InlineKeyboardButton("üìñ –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Ü–µ–Ω–Ω–æ—Å—Ç—è—Ö", callback_data="encyclopedia")],
        [InlineKeyboardButton("üîç –ê–Ω–∞–ª–∏–∑ —Ñ–∏–ª—å–º–∞", callback_data="film_analysis")],
        [InlineKeyboardButton("‚Ü©Ô∏è –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data="main_menu")]
    ]
    await query.edit_message_text(text=text, reply_markup=InlineKeyboardMarkup(keyboard), parse_mode='HTML')

async def show_categories(query):
    text = """
üé≠ <b>–§–∏–ª—å–º—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º —Ü–µ–Ω–Ω–æ—Å—Ç–µ–π:</b>

<b>–ö–æ–ª–ª–µ–∫—Ç–∏–≤–∏–∑–º –∏ —Ç—Ä—É–¥:</b>
‚Ä¢ "–í–µ—Å–Ω–∞ –Ω–∞ –ó–∞—Ä–µ—á–Ω–æ–π —É–ª–∏—Ü–µ" (1956)
‚Ä¢ "–í—ã—Å–æ—Ç–∞" (1957) 
‚Ä¢ "–ö–æ–º–º—É–Ω–∏—Å—Ç" (1957)

<b>–ü–∞—Ç—Ä–∏–æ—Ç–∏–∑–º –∏ –≤–æ–π–Ω–∞:</b>
‚Ä¢ "–û—Ñ–∏—Ü–µ—Ä—ã" (1971)
‚Ä¢ "–ê –∑–æ—Ä–∏ –∑–¥–µ—Å—å —Ç–∏—Ö–∏–µ" (1972)
‚Ä¢ "–©–∏—Ç –∏ –º–µ—á" (1968)

<b>–ù—Ä–∞–≤—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∏ –º–æ—Ä–∞–ª—å:</b>
‚Ä¢ "–î–æ–∂–∏–≤–µ–º –¥–æ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞" (1968)
‚Ä¢ "–ú–æ—Å–∫–≤–∞ —Å–ª–µ–∑–∞–º –Ω–µ –≤–µ—Ä–∏—Ç" (1979)

<b>–†–æ–º–∞–Ω—Ç–∏–∫–∞ –∏ –∫–æ–º–µ–¥–∏—è:</b>
‚Ä¢ "–ò—Ä–æ–Ω–∏—è —Å—É–¥—å–±—ã" (1975)
‚Ä¢ "–°–ª—É–∂–µ–±–Ω—ã–π —Ä–æ–º–∞–Ω" (1977)
"""
    keyboard = [
        [InlineKeyboardButton("üìö –ö —Ü–µ–Ω–Ω–æ—Å—Ç—è–º", callback_data="values")],
        [InlineKeyboardButton("üîç –ê–Ω–∞–ª–∏–∑ —Ñ–∏–ª—å–º–∞", callback_data="film_analysis")],
        [InlineKeyboardButton("üéØ –°–ª—É—á–∞–π–Ω—ã–π —Ñ–∏–ª—å–º", callback_data="random_film")],
        [InlineKeyboardButton("‚Ü©Ô∏è –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data="main_menu")]
    ]
    await query.edit_message_text(text=text, reply_markup=InlineKeyboardMarkup(keyboard), parse_mode='HTML')

async def show_film_analysis_menu(query):
    text = "üîç <b>–í—ã–±–µ—Ä–∏ —Ñ–∏–ª—å–º –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞:</b>"
    keyboard = [
        [InlineKeyboardButton("–í–µ—Å–Ω–∞ –Ω–∞ –ó–∞—Ä–µ—á–Ω–æ–π —É–ª–∏—Ü–µ", callback_data="film_vesna")],
        [InlineKeyboardButton("–î–æ–∂–∏–≤–µ–º –¥–æ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞", callback_data="film_ponedelnik")],
        [InlineKeyboardButton("–ú–æ—Å–∫–≤–∞ —Å–ª–µ–∑–∞–º –Ω–µ –≤–µ—Ä–∏—Ç", callback_data="film_moscow")],
        [InlineKeyboardButton("–û—Ñ–∏—Ü–µ—Ä—ã", callback_data="film_officers")],
        [InlineKeyboardButton("–ò—Ä–æ–Ω–∏—è —Å—É–¥—å–±—ã", callback_data="film_irony")],
        [InlineKeyboardButton("üéØ –°–ª—É—á–∞–π–Ω—ã–π —Ñ–∏–ª—å–º", callback_data="random_film")],
        [InlineKeyboardButton("‚Ü©Ô∏è –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data="main_menu")]
    ]
    await query.edit_message_text(text=text, reply_markup=InlineKeyboardMarkup(keyboard), parse_mode='HTML')

async def show_encyclopedia_menu(query):
    text = "üìñ <b>–≠–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—è —Å–æ–≤–µ—Ç—Å–∫–∏—Ö —Ü–µ–Ω–Ω–æ—Å—Ç–µ–π</b>\n\n–í—ã–±–µ—Ä–∏ —Ü–µ–Ω–Ω–æ—Å—Ç—å –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è:"
    keyboard = [
        [InlineKeyboardButton("–ö–æ–ª–ª–µ–∫—Ç–∏–≤–∏–∑–º", callback_data="value_kollektivizm")],
        [InlineKeyboardButton("–¢—Ä—É–¥", callback_data="value_trud")],
        [InlineKeyboardButton("–ü–∞—Ç—Ä–∏–æ—Ç–∏–∑–º", callback_data="value_patriotism")],
        [InlineKeyboardButton("‚Ü©Ô∏è –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data="main_menu")]
    ]
    await query.edit_message_text(text=text, reply_markup=InlineKeyboardMarkup(keyboard), parse_mode='HTML')

async def show_value_detail(query, data):
    value_key = data.replace("value_", "")
    value_map = {
        "kollektivizm": "–∫–æ–ª–ª–µ–∫—Ç–∏–≤–∏–∑–º",
        "trud": "—Ç—Ä—É–¥", 
        "patriotism": "–ø–∞—Ç—Ä–∏–æ—Ç–∏–∑–º"
    }
    
    if value_key in value_map:
        value = VALUES_DATABASE[value_map[value_key]]
        text = f"""
üìö <b>{value_map[value_key].title()} –≤ —Å–æ–≤–µ—Ç—Å–∫–æ–º –∫–∏–Ω–æ</b>

<b>–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:</b> {value['–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ']}

<b>–ü—Ä–æ—è–≤–ª–µ–Ω–∏—è –≤ –∫–∏–Ω–æ:</b>
{chr(10).join(['‚Ä¢ ' + item for item in value['–ø—Ä–æ—è–≤–ª–µ–Ω–∏—è']])}

<b>–§–∏–ª—å–º—ã-–ø—Ä–∏–º–µ—Ä—ã:</b>
{chr(10).join(['‚Ä¢ ' + film for film in value['—Ñ–∏–ª—å–º—ã']])}

<b>–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç:</b> {value['–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π_–∫–æ–Ω—Ç–µ–∫—Å—Ç']}
"""
        keyboard = [
            [InlineKeyboardButton("üìñ –ö —ç–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏–∏", callback_data="encyclopedia")],
            [InlineKeyboardButton("‚Ü©Ô∏è –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data="main_menu")]
        ]
        await query.edit_message_text(text=text, reply_markup=InlineKeyboardMarkup(keyboard), parse_mode='HTML')

async def show_film_detail(query, data):
    film_key = data.replace("film_", "")
    film_map = {
        "vesna": "–≤–µ—Å–Ω–∞ –Ω–∞ –∑–∞—Ä–µ—á–Ω–æ–π —É–ª–∏—Ü–µ",
        "ponedelnik": "–¥–æ–∂–∏–≤–µ–º –¥–æ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞", 
        "moscow": "–º–æ—Å–∫–≤–∞ —Å–ª–µ–∑–∞–º –Ω–µ –≤–µ—Ä–∏—Ç",
        "officers": "–æ—Ñ–∏—Ü–µ—Ä—ã",
        "irony": "–∏—Ä–æ–Ω–∏—è —Å—É–¥—å–±—ã"
    }
    
    if film_key in film_map and film_map[film_key] in FILMS_DATABASE:
        film_data = FILMS_DATABASE[film_map[film_key]]
        
        text = f"""
üé¨ <b>{film_map[film_key].title()}</b>

<b>–ì–æ–¥:</b> {film_data['–≥–æ–¥']}
<b>–†–µ–∂–∏—Å—Å–µ—Ä:</b> {film_data['—Ä–µ–∂–∏—Å—Å–µ—Ä']}
<b>–¶–µ–Ω–Ω–æ—Å—Ç–∏:</b> {', '.join(film_data['—Ü–µ–Ω–Ω–æ—Å—Ç–∏'])}

{film_data['–∞–Ω–∞–ª–∏–∑']}

<b>–ó–Ω–∞–º–µ–Ω–∏—Ç—ã–µ —Ü–∏—Ç–∞—Ç—ã:</b>
{chr(10).join(['‚Ä¢ ' + quote for quote in film_data['—Ü–∏—Ç–∞—Ç—ã']])}
"""
        keyboard = [
            [InlineKeyboardButton("üîç –î—Ä—É–≥–æ–π —Ñ–∏–ª—å–º", callback_data="film_analysis")],
            [InlineKeyboardButton("üìö –ö —Ü–µ–Ω–Ω–æ—Å—Ç—è–º", callback_data="values")],
            [InlineKeyboardButton("‚Ü©Ô∏è –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data="main_menu")]
        ]
        await query.edit_message_text(text=text, reply_markup=InlineKeyboardMarkup(keyboard), parse_mode='HTML')

async def show_random_film(query):
    film_name, film_data = random.choice(list(FILMS_DATABASE.items()))
    text = f"""
üéØ <b>–°–ª—É—á–∞–π–Ω—ã–π —Ñ–∏–ª—å–º –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è:</b>

üé¨ <b>{film_name.title()}</b>

<b>–ì–æ–¥:</b> {film_data['–≥–æ–¥']}
<b>–†–µ–∂–∏—Å—Å–µ—Ä:</b> {film_data['—Ä–µ–∂–∏—Å—Å–µ—Ä']}
<b>–ö–ª—é—á–µ–≤—ã–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏:</b> {', '.join(film_data['—Ü–µ–Ω–Ω–æ—Å—Ç–∏'])}

<b>–ö—Ä–∞—Ç–∫–∏–π –∞–Ω–∞–ª–∏–∑:</b>
{film_data['–∞–Ω–∞–ª–∏–∑'][:300]}...
"""
    
    # –°–æ–∑–¥–∞–µ–º callback_data –¥–ª—è —ç—Ç–æ–≥–æ —Ñ–∏–ª—å–º–∞
    film_callback_map = {
        "–≤–µ—Å–Ω–∞ –Ω–∞ –∑–∞—Ä–µ—á–Ω–æ–π —É–ª–∏—Ü–µ": "film_vesna",
        "–¥–æ–∂–∏–≤–µ–º –¥–æ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞": "film_ponedelnik",
        "–º–æ—Å–∫–≤–∞ —Å–ª–µ–∑–∞–º –Ω–µ –≤–µ—Ä–∏—Ç": "film_moscow", 
        "–æ—Ñ–∏—Ü–µ—Ä—ã": "film_officers",
        "–∏—Ä–æ–Ω–∏—è —Å—É–¥—å–±—ã": "film_irony"
    }
    
    callback_data = film_callback_map.get(film_name, "film_analysis")
    
    keyboard = [
        [InlineKeyboardButton("üìñ –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑", callback_data=callback_data)],
        [InlineKeyboardButton("üéØ –î—Ä—É–≥–æ–π —Å–ª—É—á–∞–π–Ω—ã–π —Ñ–∏–ª—å–º", callback_data="random_film")],
        [InlineKeyboardButton("üîç –í—ã–±—Ä–∞—Ç—å —Ñ–∏–ª—å–º", callback_data="film_analysis")],
        [InlineKeyboardButton("‚Ü©Ô∏è –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data="main_menu")]
    ]
    await query.edit_message_text(text=text, reply_markup=InlineKeyboardMarkup(keyboard), parse_mode='HTML')

async def start_quiz(query, context):
    context.user_data['quiz_score'] = 0
    context.user_data['quiz_current'] = 0
    await send_quiz_question(query, context)

async def send_quiz_question(query, context):
    question_index = context.user_data['quiz_current']
    
    if question_index >= len(QUIZ_QUESTIONS):
        # –í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
        score = context.user_data['quiz_score']
        total = len(QUIZ_QUESTIONS)
        text = f"<b>–í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</b>\n–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç: {score}/{total}"
        
        if score == total:
            text += "\nüéâ –û—Ç–ª–∏—á–Ω–æ! –í—ã –Ω–∞—Å—Ç–æ—è—â–∏–π —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Å–æ–≤–µ—Ç—Å–∫–æ–º—É –∫–∏–Ω–æ!"
        elif score >= total / 2:
            text += "\nüëç –•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!"
        else:
            text += "\nüìö –ï—Å—Ç—å –∫—É–¥–∞ —Ä–∞—Å—Ç–∏! –ò–∑—É—á–∞–π—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –±–æ—Ç–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ—Å—å!"
        
        keyboard = [
            [InlineKeyboardButton("üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ", callback_data="quiz_start")],
            [InlineKeyboardButton("üìö –ö —Ä–∞–∑–¥–µ–ª–∞–º", callback_data="main_menu")]
        ]
        await query.edit_message_text(text=text, reply_markup=InlineKeyboardMarkup(keyboard), parse_mode='HTML')
        return
    
    question = QUIZ_QUESTIONS[question_index]
    text = f"‚ùì <b>–í–æ–ø—Ä–æ—Å {question_index + 1}/{len(QUIZ_QUESTIONS)}</b>\n\n{question['question']}"
    
    keyboard = []
    for i, option in enumerate(question['options']):
        keyboard.append([InlineKeyboardButton(option, callback_data=f"quiz_answer_{question_index}_{i}")])
    
    keyboard.append([InlineKeyboardButton("‚Ü©Ô∏è –ü—Ä–µ—Ä–≤–∞—Ç—å –≤–∏–∫—Ç–æ—Ä–∏–Ω—É", callback_data="main_menu")])
    
    await query.edit_message_text(text=text, reply_markup=InlineKeyboardMarkup(keyboard), parse_mode='HTML')

async def handle_quiz_answer(query, context, data):
    if data.startswith("quiz_answer_"):
        parts = data.split("_")
        question_index = int(parts[2])
        answer_index = int(parts[3])
        
        question = QUIZ_QUESTIONS[question_index]
        is_correct = (answer_index == question['correct'])
        
        if is_correct:
            context.user_data['quiz_score'] += 1
            result_text = "‚úÖ <b>–ü—Ä–∞–≤–∏–ª—å–Ω–æ!</b>"
        else:
            result_text = "‚ùå <b>–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ</b>"
        
        result_text += f"\n\n{question['explanation']}"
        
        # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É
        context.user_data['quiz_current'] = question_index + 1
        
        if context.user_data['quiz_current'] < len(QUIZ_QUESTIONS):
            keyboard = [[InlineKeyboardButton("‚û°Ô∏è –°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å", callback_data=f"quiz_next_{context.user_data['quiz_current']}")]]
        else:
            keyboard = [[InlineKeyboardButton("üìä –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã", callback_data="quiz_next_0")]]
        
        await query.edit_message_text(text=result_text, reply_markup=InlineKeyboardMarkup(keyboard), parse_mode='HTML')
    
    elif data.startswith("quiz_next_"):
        await send_quiz_question(query, context)

async def show_study_materials(query):
    text = """
üí° <b>–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è —É—á–µ–±—ã:</b>

<b>–¢–µ–º—ã –¥–ª—è —Ä–µ—Ñ–µ—Ä–∞—Ç–æ–≤:</b>
1. –≠–≤–æ–ª—é—Ü–∏—è –æ–±—Ä–∞–∑–∞ –≥–µ—Ä–æ—è –≤ —Å–æ–≤–µ—Ç—Å–∫–æ–º –∫–∏–Ω–æ 1950-1980 –≥–≥.
2. –ö–æ–ª–ª–µ–∫—Ç–∏–≤–∏–∑–º –∫–∞–∫ –¥–æ–º–∏–Ω–∏—Ä—É—é—â–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å –≤ —Å–æ–≤–µ—Ç—Å–∫–æ–º –∫–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ–µ
3. –û—Ç—Ä–∞–∂–µ–Ω–∏–µ —Ç—Ä—É–¥–æ–≤–æ–π —ç—Ç–∏–∫–∏ –≤ —Ñ–∏–ª—å–º–∞—Ö –æ —Ä–∞–±–æ—á–µ–º –∫–ª–∞—Å—Å–µ
4. –ü–∞—Ç—Ä–∏–æ—Ç–∏–∑–º –≤ –≤–æ–µ–Ω–Ω–æ–º –∫–∏–Ω–æ –°–°–°–†

<b>–ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Ä–º–∏–Ω—ã:</b>
‚Ä¢ –°–æ—Ü–∏–∞–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∞–ª–∏–∑–º
‚Ä¢ –ò–¥–µ–π–Ω–æ-—Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞–º—ã—Å–µ–ª
‚Ä¢ –ö–æ–ª–ª–µ–∫—Ç–∏–≤–Ω—ã–π –≥–µ—Ä–æ–π
‚Ä¢ –¢—Ä—É–¥–æ–≤–∞—è –¥–æ–±–ª–µ—Å—Ç—å

<b>–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è –∞–Ω–∞–ª–∏–∑–∞:</b>
1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏, –ø—Ä–æ–¥–≤–∏–≥–∞–µ–º—ã–µ —Ñ–∏–ª—å–º–æ–º
2. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
3. –ò–∑—É—á–∏—Ç–µ –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
4. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
"""
    keyboard = [
        [InlineKeyboardButton("üé≠ –ö —Ñ–∏–ª—å–º–∞–º", callback_data="categories")],
        [InlineKeyboardButton("üìö –ö —Ü–µ–Ω–Ω–æ—Å—Ç—è–º", callback_data="values")],
        [InlineKeyboardButton("‚Ü©Ô∏è –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data="main_menu")]
    ]
    await query.edit_message_text(text=text, reply_markup=InlineKeyboardMarkup(keyboard), parse_mode='HTML')

async def show_main_menu(query):
    text = "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è:"
    keyboard = [
        [InlineKeyboardButton("üìö –û—Å–Ω–æ–≤–Ω—ã–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏", callback_data="values")],
        [InlineKeyboardButton("üé≠ –§–∏–ª—å–º—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º", callback_data="categories")],
        [InlineKeyboardButton("üîç –ê–Ω–∞–ª–∏–∑ —Ñ–∏–ª—å–º–∞", callback_data="film_analysis")],
        [InlineKeyboardButton("üìñ –≠–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—è —Ü–µ–Ω–Ω–æ—Å—Ç–µ–π", callback_data="encyclopedia")],
        [InlineKeyboardButton("‚ùì –í–∏–∫—Ç–æ—Ä–∏–Ω–∞", callback_data="quiz_start")],
        [InlineKeyboardButton("üí° –î–ª—è —É—á–µ–±—ã", callback_data="study")],
        [InlineKeyboardButton("üéØ –°–ª—É—á–∞–π–Ω—ã–π —Ñ–∏–ª—å–º", callback_data="random_film")]
    ]
    await query.edit_message_text(text=text, reply_markup=InlineKeyboardMarkup(keyboard))

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ñ–∏–ª—å–º–æ–≤
async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    try:
        user_text = update.message.text.lower()
        
        # –ü–æ–∏—Å–∫ —Ñ–∏–ª—å–º–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
        for film_name, film_data in FILMS_DATABASE.items():
            if any(word in user_text for word in film_name.split()):
                text = f"""
üé¨ <b>–ù–∞–π–¥–µ–Ω —Ñ–∏–ª—å–º: {film_name.title()}</b>

<b>–ì–æ–¥:</b> {film_data['–≥–æ–¥']}
<b>–†–µ–∂–∏—Å—Å–µ—Ä:</b> {film_data['—Ä–µ–∂–∏—Å—Å–µ—Ä']}
<b>–¶–µ–Ω–Ω–æ—Å—Ç–∏:</b> {', '.join(film_data['—Ü–µ–Ω–Ω–æ—Å—Ç–∏'])}

<b>–ö—Ä–∞—Ç–∫–∏–π –∞–Ω–∞–ª–∏–∑:</b>
{film_data['–∞–Ω–∞–ª–∏–∑'][:400]}...
"""
                # –û–ø—Ä–µ–¥–µ–ª—è–µ–º callback_data –¥–ª—è –∫–Ω–æ–ø–∫–∏
                film_callback_map = {
                    "–≤–µ—Å–Ω–∞ –Ω–∞ –∑–∞—Ä–µ—á–Ω–æ–π —É–ª–∏—Ü–µ": "film_vesna",
                    "–¥–æ–∂–∏–≤–µ–º –¥–æ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞": "film_ponedelnik",
                    "–º–æ—Å–∫–≤–∞ —Å–ª–µ–∑–∞–º –Ω–µ –≤–µ—Ä–∏—Ç": "film_moscow",
                    "–æ—Ñ–∏—Ü–µ—Ä—ã": "film_officers", 
                    "–∏—Ä–æ–Ω–∏—è —Å—É–¥—å–±—ã": "film_irony"
                }
                
                callback_data = film_callback_map.get(film_name, "film_analysis")
                keyboard = [[InlineKeyboardButton("üìñ –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑", callback_data=callback_data)]]
                
                await update.message.reply_text(text, reply_markup=InlineKeyboardMarkup(keyboard), parse_mode='HTML')
                return
        
        # –ï—Å–ª–∏ —Ñ–∏–ª—å–º –Ω–µ –Ω–∞–π–¥–µ–Ω
        await update.message.reply_text(
            "üîç <b>–§–∏–ª—å–º –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.</b>\n\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–¥–∏–Ω –∏–∑ —ç—Ç–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:\n‚Ä¢ –í–µ—Å–Ω–∞ –Ω–∞ –ó–∞—Ä–µ—á–Ω–æ–π —É–ª–∏—Ü–µ\n‚Ä¢ –î–æ–∂–∏–≤–µ–º –¥–æ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞\n‚Ä¢ –ú–æ—Å–∫–≤–∞ —Å–ª–µ–∑–∞–º –Ω–µ –≤–µ—Ä–∏—Ç\n‚Ä¢ –û—Ñ–∏—Ü–µ—Ä—ã\n‚Ä¢ –ò—Ä–æ–Ω–∏—è —Å—É–¥—å–±—ã\n\n–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.",
            parse_mode='HTML'
        )
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π: {e}")
        await update.message.reply_text("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–∞.")

# –ö–æ–º–∞–Ω–¥–∞ –ø–æ–º–æ—â–∏
async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    help_text = """
<b>–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:</b>
/start - –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º
/help - –ø–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É

<b>–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ—Ç–∞ –¥–ª—è —É—á–µ–±—ã:</b>
1. –ò–∑—É—á–∏—Ç–µ —Ä–∞–∑–¥–µ–ª "–û—Å–Ω–æ–≤–Ω—ã–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏"
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ "–≠–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—é" –¥–ª—è —É–≥–ª—É–±–ª–µ–Ω–Ω–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è
3. –ü–æ–¥–±–µ—Ä–∏—Ç–µ —Ñ–∏–ª—å–º—ã –ø–æ –Ω—É–∂–Ω–æ–π —Ç–µ–º–µ
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ñ–∏–ª—å–º–æ–≤
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–Ω–∞–Ω–∏—è –≤ –≤–∏–∫—Ç–æ—Ä–∏–Ω–µ

<b>–í—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—Å–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞, –∏ –±–æ—Ç –Ω–∞–π–¥–µ—Ç –µ–≥–æ –≤ –±–∞–∑–µ!</b>
"""
    await update.message.reply_text(help_text, parse_mode='HTML')

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
async def error_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    logger.error(f"–û—à–∏–±–∫–∞: {context.error}")

def main():
    try:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω
        if BOT_TOKEN == "–í–ê–®_TELEGRAM_BOT_TOKEN":
            print("‚ùå –û–®–ò–ë–ö–ê: –ó–∞–º–µ–Ω–∏—Ç–µ BOT_TOKEN –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –æ—Ç @BotFather!")
            return
        
        # –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        application = Application.builder().token(BOT_TOKEN).build()
        
        # –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
        application.add_handler(CommandHandler("start", start))
        application.add_handler(CommandHandler("help", help_command))
        application.add_handler(CallbackQueryHandler(button_handler))
        application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))
        
        # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
        application.add_error_handler(error_handler)
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
        print("ü§ñ –ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...")
        print("‚úÖ –ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ, –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ")
        print("‚ùå –ï—Å–ª–∏ –±–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π BOT_TOKEN")
        
        application.run_polling()
        
    except Exception as e:
        print(f"‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ: {e}")
        print("–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:")
        print("1. –¢–æ–∫–µ–Ω –±–æ—Ç–∞")
        print("2. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ª–∏ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: pip install python-telegram-bot")
        print("3. –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ")

if __name__ == '__main__':
    main()